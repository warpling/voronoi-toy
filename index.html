<html>
  <head>
    <meta charset="utf-8">
    <link type="text/css" rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
  </head>
  <body class="vignette">
    <h2 id="name">Hello! My name is Ryan.</h2>
    <h2 id="name">I like making things like this</h2>
    <h2 id="name">instead of studying.</h2>

    <!-- <div class="card"></div> -->

    <script type="text/javascript">

    var width = $(window).width(),
        height = $(window).height(),
        τ = 2 * Math.PI;

    // var numVertices = (width * height) / 20000;
    var numVertices = 1;

    var nodes = d3.range(numVertices).map(function() {
      return {
        x: Math.random() * width,
        y: Math.random() * height
      };
    });

    var attractionPoint = {x:width/2, y:height/2};

    var voronoi = d3.geom.voronoi()
        .x(function(d) { return d.x; })
        .y(function(d) { return d.y; });

    var links = voronoi.links(nodes);

    var force = d3.layout.force()
        .friction(.95)
        .gravity(.03)
        // .charge(-100)
        // .alpha(2)
        .size([width, height])
        .nodes(nodes)
        .links(links)
        .on("tick", ticked)
        .start();

    var canvas = d3.select("body").append("canvas")
        .attr("id", "graph_canvas")
        .attr("width", width)
        .attr("height", height);

    var context = canvas.node().getContext("2d");

    function ticked(e) {

      // Draw new lines
      links = voronoi.links(force.nodes())

      // Clear screen
      context.clearRect(0, 0, width, height);

      drawDots(context, nodes);
      drawLines(context, links)

    }

    // Move nodes toward cluster focus.
    // function gravity(alpha) {
    //   return function(d) {
    //     d.y += (attractionPoint.y - d.y) * alpha;
    //     d.x += (attractionPoint.x - d.x) * alpha;
    //   };
    // }

    d3.select(window).on("focus", function() {
      force.resume();
    });

    d3.select(window).on("blur", function() {
      force.stop();
    });

    d3.select(window).on("mousemove", function() {
      force.resume();
    });


    d3.select(window).on("click", function() {
      var cursor = d3.mouse(graph_canvas);
      addPoint(cursor);
    })

    function addPoint(coordinates) {      
      force.stop();
      nodes.push({
          x: coordinates[0],
          y: coordinates[1]
        });

      links = voronoi.links(force.nodes())

      force.start();
    }

    function drawDots(context, nodes) {
      context.beginPath();
      nodes.forEach(function(d) {
        context.moveTo(d.x, d.y);
        context.arc(d.x, d.y, 2, 0, τ);
      });
      context.lineWidth = 4;
      context.strokeStyle = "#4DA2DB";
      context.stroke();
      context.fillStyle = "#375585";
      context.fill();
    }

    function drawLines(context, links) {
      context.beginPath();

      links.forEach(function(d) {
        context.moveTo(d.source.x, d.source.y);
        context.lineTo(d.target.x, d.target.y);
      });

      context.lineWidth = 1;
      context.strokeStyle = "#1D72AB";
      context.stroke();
    }

    </script>
  </body>
</html>
